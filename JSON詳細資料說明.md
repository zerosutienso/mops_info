# JSON 詳細資料功能說明

## 🎯 功能概述

我們的 CLI 工具現在能夠從台灣證交所的重大訊息中提取完整的詳細資料，並以結構化的 JSON 格式輸出。這些詳細資料原本只能透過點擊網頁上的「詳細資料」按鈕才能查看。

## 📊 JSON 資料結構

每筆重大訊息的 JSON 資料包含以下欄位：

### 基本資料欄位
- `company_code`: 公司代號（如：2330、2882）
- `company_name`: 公司名稱（如：台積電、國泰金）
- `title`: 重大訊息標題
- `date`: 發言日期（民國年格式）
- `time`: 發言時間

### 詳細資料欄位（新增）
- `detail_content`: 完整的詳細內容（包含所有申報項目）
- `announcement_type`: 公告類型（如：符合條款第四條第XX款）
- `fact_date`: 事實發生日期

## 🔍 詳細資料內容範例

### 1. 台積電 - 取得固定收益證券
```json
{
  "company_code": "2330",
  "company_name": "台積電",
  "title": "本公司代子公司 TSMC Global Ltd. 公告取得固定收益證券",
  "date": "114/08/15",
  "time": "17:40:31",
  "detail_content": "1.證券名稱:\n公司債。\n2.交易日期:114/8/12~114/8/15\n3.董事會通過日期: 不適用\n4.其他核決日期:\n核決層級:不適用。\n民國114年08月15日\n5.交易數量、每單位價格及交易總金額:\n61747YEC5：400,000 單位；每單位US$97.43；總金額US$39.0 佰萬元。\n06051GJS9：300,000 單位；每單位US$97.60；總金額US$29.3 佰萬元。\n..."
}
```

### 2. 國泰金 - 財務報告
```json
{
  "company_code": "2882",
  "company_name": "國泰金",
  "title": "公告本公司董事會通過114年上半年度決算財務報告",
  "date": "114/08/15",
  "time": "16:51:09",
  "detail_content": "1.提報董事會或經董事會決議日期:114/08/15\n2.審計委員會通過日期:114/08/14\n3.財務報告或年度自結財務資訊報導期間\n起訖日期(XXX/XX/XX~XXX/XX/XX):114/01/01~114/06/30\n4.1月1日累計至本期止利息淨收益(仟元):132,937,819\n5.1月1日累計至本期止淨收益(仟元):130,845,522\n6.1月1日累計至本期止稅前淨利(損) (仟元):53,132,212\n7.1月1日累計至本期止本期淨利(淨損) (仟元):45,908,613\n8.1月1日累計至本期止歸屬於母公司業主淨利(損) (仟元):46,000,311\n9.1月1日累計至本期止基本每股盈餘(損失) (元):2.89\n10.期末總資產(仟元):13,786,756,729\n11.期末總負債(仟元):13,005,385,073\n12.期末歸屬於母公司業主之權益(仟元):764,897,518\n13.其他應敘明事項:無"
}
```

### 3. 國泰金 - 人事異動
```json
{
  "company_code": "2882",
  "company_name": "國泰金",
  "title": "公告本公司新設永續長",
  "date": "114/08/15",
  "time": "16:51:40",
  "detail_content": "1.人員變動別（請輸入發言人、代理發言人、重要營運主管(如:執行長、營運長、\n行銷長及策略長等)、財務主管、會計主管、公司治理主管、資訊安全長、研發主管、\n內部稽核主管或訴訟及非訟代理人）:永續長\n2.發生變動日期:114/08/15\n3.舊任者姓名、級職及簡歷:不適用\n4.新任者姓名、級職及簡歷:李長庚、國泰金控總經理\n5.異動情形（請輸入「辭職」、「職務調整」、「資遣」、「退休」、「死亡」、「新\n任」或「解任」）:新任\n6.異動原因:新任\n7.生效日期:114/08/16\n8.其他應敘明事項:無"
}
```

## 🚀 使用方式

### 查詢特定公司的詳細資料
```bash
# 查詢台積電的詳細資料
cargo run -- --date 2025-08-15 --company 2330 --format json

# 查詢國泰金的詳細資料並儲存到自訂檔案
cargo run -- --date 2025-08-15 --company 2882 --format json --output cathay_detailed
```

### 查詢全部公司的詳細資料
```bash
# 查詢指定日期所有公司的詳細資料
cargo run -- --date 2025-08-15 --format json
```

## 📋 詳細資料的價值

### 1. 投資分析
- **財務數據**：直接獲取公司財報數據，如營收、淨利、每股盈餘等
- **交易資訊**：了解公司重大交易的詳細條件和金額
- **股利資訊**：獲取除權息的完整時程和金額

### 2. 公司治理
- **人事異動**：追蹤重要主管的異動情況
- **董事會決議**：了解重要決策的詳細內容
- **關係人交易**：監控公司與關係人的交易

### 3. 風險管理
- **法規遵循**：確認公司是否符合相關法規要求
- **重大事件**：及時掌握可能影響股價的重大事件
- **投資決策**：基於完整資訊做出更好的投資決策

## 🔧 技術實現

### 資料提取方式
1. **HTML 解析**：從證交所的 HTML 回應中提取隱藏的表單資料
2. **智能識別**：自動識別包含詳細資料的 input 欄位（如 h08、h18 等）
3. **結構化處理**：將原始文字資料轉換為結構化的 JSON 格式

### 資料完整性
- **原始內容保留**：完整保留證交所提供的所有詳細資料
- **格式標準化**：統一的 JSON 格式，便於程式處理
- **選擇性顯示**：使用 `serde` 的 `skip_serializing_if` 功能，只顯示有資料的欄位

## 📁 檔案輸出

執行 JSON 格式查詢時，會自動產生：
- **控制台輸出**：即時顯示 JSON 資料
- **JSON 檔案**：自動儲存到 `檔名_YYYYMMDD.json`

範例檔案：
- `twse_announcements_20250815.json` - 全部公司資料
- `cathay_detailed_20250815.json` - 國泰金詳細資料
- `tsmc_announcements_20250815.json` - 台積電詳細資料

## 🎉 總結

這個功能大幅提升了工具的實用性，讓使用者能夠：
1. **一次性獲取**所有重大訊息的詳細資料
2. **程式化處理**結構化的 JSON 資料
3. **深度分析**公司的重大事件和財務狀況
4. **自動化監控**特定公司或事件類型

這使得我們的 CLI 工具不僅是一個查詢工具，更是一個強大的金融資料分析平台！
