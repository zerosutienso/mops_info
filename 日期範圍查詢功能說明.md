# 📅 MongoDB Web 查詢 - 起訖日期功能

## 🎯 新增功能概述

根據你的需求，我已經為 MongoDB Web 查詢添加了完整的起訖日期功能，讓你可以精確指定日期範圍進行查詢。

## ✨ 主要新增功能

### 1. **📅 起訖日期輸入欄位**
- **起始日期**: 指定查詢的開始日期
- **結束日期**: 指定查詢的結束日期
- **日期格式**: 使用標準的 `YYYY-MM-DD` 格式
- **自動轉換**: 後端自動轉換為民國年格式進行查詢

### 2. **⚡ 快速日期設定按鈕**
- **今日**: 一鍵設定為今天的日期
- **昨日**: 一鍵設定為昨天的日期
- **本週**: 設定為本週的日期範圍
- **本月**: 設定為本月的日期範圍
- **清除日期**: 清除所有日期設定
- **重置**: 重置整個搜尋表單

### 3. **📊 智能統計面板**
- **動態日期顯示**: 根據查詢條件顯示日期範圍
- **單日顯示**: 當起訖日期相同時，只顯示單一日期
- **範圍顯示**: 顯示 `起始日期 ~ 結束日期` 格式
- **全部日期**: 當沒有設定日期時顯示 "全部日期"

### 4. **🔧 筆數限制控制**
- **彈性選擇**: 50、100、200、500、1000 筆
- **效能優化**: 避免一次載入過多資料
- **預設值**: 預設為 50 筆

## 🎨 介面設計

### 搜尋表單佈局
```
┌─────────────────────────────────────────────────────────────────┐
│ 公司代號  │ 起始日期  │ 結束日期  │ 關鍵字搜尋    │ 筆數限制 │ 搜尋 │
├─────────────────────────────────────────────────────────────────┤
│ [今日] [昨日] [本週] [本月] [清除日期] [重置]                      │
└─────────────────────────────────────────────────────────────────┘
```

### 統計面板顯示
```
┌─────────────────────────────────────────────────────────────────┐
│ 📊 統計資訊                                                      │
├─────────────────────────────────────────────────────────────────┤
│   125 筆        15 家        2025-08-14 ~ 2025-08-15           │
│ 重大訊息       公司          查詢範圍                            │
└─────────────────────────────────────────────────────────────────┘
```

## 🚀 使用方式

### 1. **基本日期範圍查詢**
```javascript
// 查詢單一日期
起始日期: 2025-08-15
結束日期: 2025-08-15
結果: 顯示 "2025-08-15"

// 查詢日期範圍
起始日期: 2025-08-10
結束日期: 2025-08-15
結果: 顯示 "2025-08-10 ~ 2025-08-15"
```

### 2. **快速日期設定**
```javascript
// 點擊快速按鈕
[今日]   → 設定為今天
[昨日]   → 設定為昨天
[本週]   → 設定為本週範圍
[本月]   → 設定為本月範圍
[清除]   → 清除所有日期
[重置]   → 重置整個表單
```

### 3. **組合查詢**
```javascript
// 複合條件查詢
公司代號: 2330
起始日期: 2025-08-10
結束日期: 2025-08-15
關鍵字: 財務報告
筆數限制: 100
```

### 4. **開放式查詢**
```javascript
// 只設定起始日期
起始日期: 2025-08-10
結束日期: (空白)
結果: 查詢 2025-08-10 之後的所有資料

// 只設定結束日期
起始日期: (空白)
結束日期: 2025-08-15
結果: 查詢 2025-08-15 之前的所有資料
```

## 🔧 技術實現

### 前端處理
```javascript
// 日期範圍設定函數
function setDateRange(range) {
    const today = new Date();
    let startDate, endDate;
    
    switch (range) {
        case 'today':
            startDate = endDate = today;
            break;
        case 'week':
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay());
            startDate = weekStart;
            endDate = today;
            break;
        // ... 其他範圍
    }
}

// 搜尋參數建構
const params = new URLSearchParams();
if (startDate) params.append('start_date', startDate);
if (endDate) params.append('end_date', endDate);
```

### 後端處理
```rust
// 查詢參數結構
#[derive(Debug, Deserialize)]
pub struct QueryParams {
    pub start_date: Option<String>,
    pub end_date: Option<String>,
    // ... 其他參數
}

// 日期轉換函數
fn convert_to_roc_date(date_str: &str) -> Option<String> {
    // 轉換 YYYY-MM-DD 到 YYY/MM/DD (民國年)
    let year: i32 = parts[0].parse().ok()?;
    let roc_year = year - 1911;
    Some(format!("{}/{}/{}", roc_year, month, day))
}

// MongoDB 查詢建構
if let (Some(start_date), Some(end_date)) = (&params.start_date, &params.end_date) {
    let start_roc = convert_to_roc_date(start_date);
    let end_roc = convert_to_roc_date(end_date);
    
    filter.insert("query_date", doc! {
        "$gte": start_roc,
        "$lte": end_roc
    });
}
```

## 📊 查詢範例

### 範例 1: 查詢台積電本週公告
```
公司代號: 2330
點擊 [本週] 按鈕
點擊 [搜尋] 按鈕
```

### 範例 2: 查詢財務報告相關公告
```
關鍵字: 財務報告
起始日期: 2025-08-10
結束日期: 2025-08-15
筆數限制: 200
```

### 範例 3: 查詢昨日所有公告
```
點擊 [昨日] 按鈕
筆數限制: 500
點擊 [搜尋] 按鈕
```

### 範例 4: 查詢特定日期範圍
```
起始日期: 2025-08-01
結束日期: 2025-08-31
公司代號: (空白 - 查詢所有公司)
筆數限制: 1000
```

## 🎯 使用場景

### 1. **日常監控** 📈
- 每日查看當天或前一天的公告
- 使用快速按鈕快速設定日期
- 關注特定公司的最新動態

### 2. **週期性分析** 📊
- 查看本週或本月的公告趨勢
- 分析特定時間段的市場動態
- 製作定期投資報告

### 3. **事件追蹤** 🔍
- 追蹤特定事件的相關公告
- 查詢特定日期範圍內的重要訊息
- 分析公司重大決策的時間軸

### 4. **歷史研究** 📚
- 查詢過去特定期間的公告
- 分析歷史事件對股市的影響
- 建立投資決策的歷史資料庫

## 🆚 功能比較

| 功能 | 原版 | 新版 |
|------|------|------|
| 日期查詢 | 單一日期 | ✅ 起訖日期範圍 |
| 快速設定 | 無 | ✅ 今日/昨日/本週/本月 |
| 統計顯示 | 固定格式 | ✅ 動態日期範圍顯示 |
| 筆數控制 | 固定 50 筆 | ✅ 彈性選擇 50-1000 筆 |
| 表單重置 | 無 | ✅ 一鍵重置功能 |
| 日期清除 | 無 | ✅ 一鍵清除日期 |

## 🎉 優化效果

### 查詢靈活性提升
1. **📅 精確日期控制**: 可以指定任意日期範圍
2. **⚡ 快速操作**: 一鍵設定常用日期範圍
3. **🔄 靈活組合**: 支援各種查詢條件組合
4. **📊 智能顯示**: 統計面板動態顯示查詢範圍

### 使用體驗提升
1. **🎯 直觀操作**: 清晰的日期輸入欄位
2. **⚡ 快速設定**: 常用日期範圍一鍵設定
3. **🔧 彈性控制**: 可調整查詢筆數限制
4. **🔄 便利重置**: 一鍵重置所有條件

### 效能優化
1. **📊 智能查詢**: 後端優化的日期範圍查詢
2. **⚡ 限制控制**: 避免一次載入過多資料
3. **🔄 快取機制**: 優化的 MongoDB 查詢
4. **📱 響應式設計**: 適配各種裝置

## 🚀 啟動方式

### 使用優化啟動腳本
```bash
.\start_optimized_web.bat
```

### 或直接啟動
```bash
cargo run --bin simple_web_server
```

### 瀏覽器訪問
```
http://127.0.0.1:3000
```

現在你的 MongoDB Web 查詢已經具備完整的起訖日期功能，可以進行更精確和靈活的資料查詢！🎊
