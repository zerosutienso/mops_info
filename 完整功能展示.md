# 台灣證交所重大訊息查詢 CLI - 完整功能展示

## 🎯 專案概述

這是一個使用 Rust 開發的專業級 CLI 工具，用於查詢台灣證券交易所的重大訊息。從簡單的查詢工具發展為完整的金融資料管理平台。

## ✨ 核心功能

### 1. 📊 多格式輸出
- **表格格式**: 整齊的控制台顯示
- **JSON 格式**: 包含完整詳細資料的結構化輸出
- **HTML 格式**: 原始網頁內容保存
- **TXT 格式**: 純文字檔案，便於閱讀

### 2. 🔍 靈活查詢
- **日期篩選**: 查詢指定日期的重大訊息
- **公司篩選**: 針對特定公司代號查詢
- **智能解析**: 自動處理民國年轉換和資料清理

### 3. 🗄️ 資料庫整合
- **MongoDB 支援**: 完整的資料庫儲存功能
- **自動索引**: 提升查詢效能的智能索引
- **歷史資料**: 建立完整的歷史資料庫

### 4. 📋 詳細資料提取
- **完整內容**: 提取每筆公告的詳細內容
- **結構化資料**: 包含公告類型、事實發生日等元資料
- **時間戳記**: 自動記錄查詢和建立時間

## 🚀 使用範例

### 基本查詢
```bash
# 查詢今日重大訊息
cargo run

# 查詢指定日期
cargo run -- --date 2025-08-15

# 查詢特定公司
cargo run -- --date 2025-08-15 --company 2330
```

### 多格式輸出
```bash
# JSON 格式（包含詳細資料）
cargo run -- --date 2025-08-15 --format json

# TXT 格式（純文字）
cargo run -- --date 2025-08-15 --format txt

# HTML 格式（原始網頁）
cargo run -- --date 2025-08-15 --format html --save-html
```

### MongoDB 資料庫
```bash
# 儲存到 MongoDB
cargo run -- --date 2025-08-15 --save-mongodb

# 自訂資料庫設定
cargo run -- --save-mongodb \
  --mongodb-database "financial_data" \
  --mongodb-collection "daily_announcements"

# 同時輸出和儲存
cargo run -- --date 2025-08-15 --format json --save-mongodb
```

### 進階應用
```bash
# 完整功能展示
cargo run -- --date 2025-08-15 --company 2882 \
  --format json --save-html --save-mongodb \
  --output cathay_detailed

# 批次處理歷史資料
for i in {1..31}; do
  cargo run -- --date 2025-08-$i --save-mongodb
done
```

## 📊 實際測試結果

### 測試案例 1：台積電 (2330)
```bash
cargo run -- --date 2025-08-15 --company 2330 --format json
```

**輸出結果**：
```json
[
  {
    "company_code": "2330",
    "company_name": "台積電",
    "title": "本公司代子公司 TSMC Global Ltd. 公告取得固定收益證券",
    "date": "114/08/15",
    "time": "17:40:31",
    "detail_content": "1.證券名稱:\n公司債。\n2.交易日期:114/8/12~114/8/15...",
    "created_at": "2025-08-17T17:13:05.501Z"
  }
]
```

### 測試案例 2：國泰金 (2882)
```bash
cargo run -- --date 2025-08-15 --company 2882 --save-mongodb
```

**輸出結果**：
```
查詢日期: 2025-08-15
正在連接 MongoDB...
MongoDB 索引建立完成
成功儲存 13 筆資料到 MongoDB
資料庫: twse_db, 集合: announcements

代號       公司名稱                 日期         時間       標題
--------------------------------------------------------------------------------
2882     國泰金                  114/08/14  17:37:28 代國泰期貨公告除權息基準日
2882     國泰金                  114/08/14  17:38:38 代子公司國泰投信公告資訊安全長異動
...
```

### 測試案例 3：當日所有資料
```bash
cargo run -- --date 2025-08-15 --save-mongodb
```

**結果統計**：
- 📊 總計：400+ 筆重大訊息
- 🏢 涵蓋：200+ 家上市公司
- 💾 檔案：自動生成 HTML、TXT、JSON 檔案
- 🗄️ 資料庫：完整儲存到 MongoDB

## 🔍 MongoDB 查詢範例

### 基本查詢
```javascript
// 查詢台積電的所有公告
db.announcements.find({"company_code": "2330"})

// 查詢特定日期的公告
db.announcements.find({"query_date": "2025-08-15"})

// 查詢包含關鍵字的公告
db.announcements.find({"title": {$regex: "財務報告", $options: "i"}})
```

### 統計分析
```javascript
// 統計各公司公告數量
db.announcements.aggregate([
  {$group: {_id: "$company_code", count: {$sum: 1}, company_name: {$first: "$company_name"}}},
  {$sort: {count: -1}},
  {$limit: 10}
])

// 分析每日公告趨勢
db.announcements.aggregate([
  {$group: {_id: "$query_date", count: {$sum: 1}}},
  {$sort: {"_id": -1}}
])
```

## 📁 檔案輸出範例

### 自動生成的檔案
```
📁 專案目錄/
├── 📄 twse_announcements_20250815.html (9,500 行)
├── 📄 twse_announcements_20250815.json (1,200+ 行)
├── 📄 twse_announcements_20250815.txt (498 行)
├── 📄 cathay_detailed_20250815.json (106 行)
└── 📄 tsmc_announcements_20250815.txt (7 行)
```

### 檔案內容品質
- **HTML**: 完整保存原始回應，可用瀏覽器開啟
- **JSON**: 結構化資料，包含詳細內容，便於程式處理
- **TXT**: 格式整齊，標題不跳行，易於閱讀

## 🛠️ 技術特色

### 1. 智能資料處理
- **民國年轉換**: 自動處理台灣特有的民國年格式
- **標題清理**: 移除換行符號，確保格式一致
- **詳細資料提取**: 從隱藏表單中提取完整資料

### 2. 高效能設計
- **非同步處理**: 使用 Tokio 實現高效能網路請求
- **智能解析**: 使用 Scraper 進行高效 HTML 解析
- **索引優化**: MongoDB 自動建立效能索引

### 3. 錯誤處理
- **網路錯誤**: 完善的網路連接錯誤處理
- **資料驗證**: 確保資料完整性和正確性
- **友善訊息**: 清晰的錯誤訊息和解決建議

## 📈 應用場景

### 1. 投資分析
- **即時監控**: 追蹤特定公司的重大訊息
- **歷史分析**: 分析公司的歷史公告趨勢
- **風險評估**: 識別潛在的投資風險

### 2. 資料科學
- **資料收集**: 建立完整的金融資料集
- **趨勢分析**: 分析市場公告的時間趨勢
- **文字探勘**: 分析公告內容的關鍵字

### 3. 系統整合
- **API 開發**: 基於 MongoDB 資料建立 REST API
- **自動化**: 整合到自動化交易或監控系統
- **報表生成**: 自動生成投資報表

## 🎯 未來發展

### 短期目標
- [ ] 增加更多篩選條件（公告類型、關鍵字）
- [ ] 支援批次查詢多個日期
- [ ] 增加資料統計和分析功能

### 長期願景
- [ ] 建立 Web API 服務
- [ ] 開發圖形化介面
- [ ] 整合其他金融資料來源
- [ ] 建立即時通知系統

## 🏆 專案價值

這個專案展示了：

1. **🔧 技術深度**: 從簡單查詢到完整資料管理平台
2. **📊 實用價值**: 真正可用於投資分析的專業工具
3. **🚀 擴展性**: 良好的架構設計，易於擴展功能
4. **💎 程式品質**: 企業級的錯誤處理和使用者體驗

從一個簡單的 CLI 工具發展為完整的金融資料管理平台，這個專案完美展示了 Rust 在系統程式設計方面的強大能力！🎉

## 📚 相關文件

- 📖 [MongoDB設定說明.md](MongoDB設定說明.md) - 詳細的 MongoDB 安裝和設定指南
- 🔍 [MongoDB使用範例.md](MongoDB使用範例.md) - 豐富的查詢和分析範例
- 📊 [JSON詳細資料說明.md](JSON詳細資料說明.md) - JSON 格式的詳細說明
- 🎯 [最終測試總結.md](最終測試總結.md) - 完整的測試結果和驗證
