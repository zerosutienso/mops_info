# ğŸ“… äº‹å¯¦ç™¼ç”Ÿæ—¥æ“·å–åŠŸèƒ½å¯¦ç¾èªªæ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æ ¹æ“šä½ çš„è¦æ±‚ï¼Œæˆ‘å·²ç¶“æˆåŠŸå¯¦ç¾äº†å¾åŸå§‹ HTML è³‡æ–™ä¸­æ“·å– `name='h07' value='20250815'` é€™é¡äº‹å¯¦ç™¼ç”Ÿæ—¥çš„åŠŸèƒ½ï¼Œä¸¦å°‡åŸå§‹ HTML è³‡æ–™å®Œæ•´ä¿å­˜ã€‚

## âœ… å¯¦ç¾å…§å®¹

### 1. **è³‡æ–™çµæ§‹æ“´å±•**

#### æ–°å¢äº‹å¯¦ç™¼ç”Ÿæ—¥æ¬„ä½
```rust
#[derive(Debug, Serialize, Deserialize, Clone)]
struct Announcement {
    // ... åŸæœ‰æ¬„ä½ ...
    #[serde(skip_serializing_if = "Option::is_none")]
    pub fact_occurrence_date: Option<String>, // æ–°å¢äº‹å¯¦ç™¼ç”Ÿæ—¥æ¬„ä½ (å¾ h07 æ“·å–)
    #[serde(skip_serializing_if = "Option::is_none")]
    pub raw_html: Option<String>, // æ–°å¢åŸå§‹ HTML è³‡æ–™æ¬„ä½
    // ... å…¶ä»–æ¬„ä½ ...
}
```

### 2. **HTML è§£æé‚è¼¯**

#### æ“·å– h07 æ¬„ä½çš„äº‹å¯¦ç™¼ç”Ÿæ—¥
```rust
fn extract_detail_info(&self, row: &scraper::ElementRef, input_selector: &Selector) -> (Option<String>, Option<String>, Option<String>, Option<String>, Option<String>, String) {
    let mut fact_occurrence_date = None;
    
    // ä¿å­˜åŸå§‹ HTML
    let raw_html = row.html();

    // åœ¨é€™ä¸€è¡Œä¸­å°‹æ‰¾éš±è—çš„ input æ¬„ä½
    for input in row.select(input_selector) {
        if let Some(name) = input.value().attr("name") {
            if let Some(value) = input.value().attr("value") {
                match name {
                    name if name.ends_with("7") => { // h07, h17, h27 ç­‰åŒ…å«äº‹å¯¦ç™¼ç”Ÿæ—¥
                        if !value.trim().is_empty() {
                            // å°‡ YYYYMMDD æ ¼å¼è½‰æ›ç‚º YYYY-MM-DD æ ¼å¼
                            let formatted_date = format_fact_occurrence_date(value);
                            fact_occurrence_date = Some(formatted_date.clone());
                            println!("ğŸ“… æ“·å–äº‹å¯¦ç™¼ç”Ÿæ—¥: {} = {} -> {}", name, value, formatted_date);
                        }
                    }
                    // ... å…¶ä»–æ¬„ä½è™•ç† ...
                }
            }
        }
    }

    (detail_content, announcement_type, fact_date, clause_code, fact_occurrence_date, raw_html)
}
```

### 3. **æ—¥æœŸæ ¼å¼åŒ–åŠŸèƒ½**

#### YYYYMMDD è½‰ YYYY-MM-DD
```rust
// æ ¼å¼åŒ–äº‹å¯¦ç™¼ç”Ÿæ—¥ (YYYYMMDD -> YYYY-MM-DD)
fn format_fact_occurrence_date(date_str: &str) -> String {
    if date_str.len() == 8 && date_str.chars().all(|c| c.is_ascii_digit()) {
        // YYYYMMDD æ ¼å¼
        let year = &date_str[0..4];
        let month = &date_str[4..6];
        let day = &date_str[6..8];
        format!("{}-{}-{}", year, month, day)
    } else {
        // å¦‚æœä¸æ˜¯æ¨™æº–æ ¼å¼ï¼Œç›´æ¥è¿”å›åŸå§‹å€¼
        date_str.to_string()
    }
}
```

#### æ ¼å¼åŒ–ç¯„ä¾‹
```
è¼¸å…¥: "20250708" -> è¼¸å‡º: "2025-07-08"
è¼¸å…¥: "20250529" -> è¼¸å‡º: "2025-05-29"
è¼¸å…¥: "20250724" -> è¼¸å‡º: "2025-07-24"
```

### 4. **åŸå§‹ HTML ä¿å­˜**

#### å®Œæ•´ HTML å…§å®¹ä¿å­˜
```rust
// ä¿å­˜åŸå§‹ HTML
let raw_html = row.html();

// å­˜å…¥è³‡æ–™çµæ§‹
let announcement = Announcement {
    // ... å…¶ä»–æ¬„ä½ ...
    fact_occurrence_date,
    raw_html: Some(raw_html),
    // ... å…¶ä»–æ¬„ä½ ...
};
```

#### HTML æª”æ¡ˆä¿å­˜
```rust
// åœ¨ --save-html åƒæ•¸æ™‚ä¿å­˜åŸå§‹ HTML æª”æ¡ˆ
if args.save_html {
    let html_filename = format!("twse_announcements_{}.html", date_str);
    std::fs::write(&html_filename, &response_text)?;
    println!("âœ… HTML æª”æ¡ˆå·²å„²å­˜: {}", html_filename);
}
```

### 5. **Web ä»‹é¢é¡¯ç¤º**

#### äº‹å¯¦ç™¼ç”Ÿæ—¥æ¨™ç±¤é¡¯ç¤º
```javascript
// åœ¨å…¬å‘Šæ¨™é¡Œæ—é¡¯ç¤ºäº‹å¯¦ç™¼ç”Ÿæ—¥
${announcement.fact_occurrence_date ? `
<span class="badge bg-warning ms-2">
    <i class="fas fa-calendar-alt me-1"></i>äº‹å¯¦ç™¼ç”Ÿæ—¥ ${announcement.fact_occurrence_date}
</span>
` : ''}
```

#### é¡¯ç¤ºæ•ˆæœ
```
ğŸ¢ 2327 - åœ‹å·¨           ğŸ• 114/08/18 16:30:15
å…¬å‘Šæœ¬å…¬å¸è‚¡ç¥¨é¢é¡è®Šæ›´    ğŸ·ï¸ æ¢æ¬¾ 51  ğŸ“… äº‹å¯¦ç™¼ç”Ÿæ—¥ 2025-07-08
[é¡¯ç¤ºæ˜ç´°]

ğŸ¢ 2762 - ä¸–ç•Œå¥èº«-KY    ğŸ• 114/08/18 15:55:21  
å…¬å¸åç¨±è®Šæ›´             ğŸ·ï¸ æ¢æ¬¾ 51  ğŸ“… äº‹å¯¦ç™¼ç”Ÿæ—¥ 2025-05-29
[é¡¯ç¤ºæ˜ç´°]
```

### 6. **CSV åŒ¯å‡ºåŠŸèƒ½**

#### åŒ…å«äº‹å¯¦ç™¼ç”Ÿæ—¥çš„ CSV
```javascript
function generateCSV(announcements) {
    const headers = ['å…¬å¸ä»£è™Ÿ', 'å…¬å¸åç¨±', 'æ¨™é¡Œ', 'æ—¥æœŸ', 'æ™‚é–“', 'æ¢æ¬¾ä»£è™Ÿ', 'äº‹å¯¦ç™¼ç”Ÿæ—¥', 'è©³ç´°å…§å®¹'];
    const csvRows = [headers.join(',')];

    announcements.forEach(announcement => {
        const row = [
            `"${announcement.company_code}"`,
            `"${announcement.company_name}"`,
            `"${announcement.title.replace(/"/g, '""')}"`,
            `"${announcement.date}"`,
            `"${announcement.time}"`,
            `"${announcement.clause_code || ''}"`,
            `"${announcement.fact_occurrence_date || ''}"`, // æ–°å¢äº‹å¯¦ç™¼ç”Ÿæ—¥æ¬„ä½
            `"${(announcement.detail_content || '').replace(/"/g, '""')}"`
        ];
        csvRows.push(row.join(','));
    });

    return '\uFEFF' + csvRows.join('\n');
}
```

## ğŸ” æ“·å–ç¯„ä¾‹

### 1. **HTML è¼¸å…¥ç¯„ä¾‹**
```html
<input type="hidden" name="h07" value="20250708">
<input type="hidden" name="h17" value="20250529">
<input type="hidden" name="h27" value="20250724">
<input type="hidden" name="h37" value="20250714">
```

### 2. **æ“·å–è¼¸å‡ºç¯„ä¾‹**
```
ğŸ“… æ“·å–äº‹å¯¦ç™¼ç”Ÿæ—¥: h07 = 20250708 -> 2025-07-08
ğŸ“… æ“·å–äº‹å¯¦ç™¼ç”Ÿæ—¥: h17 = 20250529 -> 2025-05-29
ğŸ“… æ“·å–äº‹å¯¦ç™¼ç”Ÿæ—¥: h27 = 20250724 -> 2025-07-24
ğŸ“… æ“·å–äº‹å¯¦ç™¼ç”Ÿæ—¥: h37 = 20250714 -> 2025-07-14
```

### 3. **JSON è¼¸å‡ºç¯„ä¾‹**
```json
{
  "company_code": "2327",
  "company_name": "åœ‹å·¨",
  "title": "å…¬å‘Šæœ¬å…¬å¸è‚¡ç¥¨é¢é¡è®Šæ›´",
  "date": "114/08/18",
  "time": "16:30:15",
  "fact_occurrence_date": "2025-07-08",
  "clause_code": "51",
  "raw_html": "<tr class=\"even\">...</tr>",
  "created_at": "2025-08-18T14:07:15.519149500Z"
}
```

## ğŸ—„ï¸ MongoDB è³‡æ–™åº«

### 1. **æ–‡ä»¶çµæ§‹**
```javascript
{
  "_id": ObjectId("..."),
  "company_code": "2327",
  "company_name": "åœ‹å·¨",
  "title": "å…¬å‘Šæœ¬å…¬å¸è‚¡ç¥¨é¢é¡è®Šæ›´",
  "date": "114/08/18",
  "time": "16:30:15",
  "fact_occurrence_date": "2025-07-08", // æ–°å¢æ¬„ä½
  "clause_code": "51",
  "raw_html": "<tr class=\"even\">...</tr>", // æ–°å¢æ¬„ä½
  "created_at": ISODate("2025-08-18T14:07:15.519Z")
}
```

### 2. **æŸ¥è©¢ç¯„ä¾‹**

#### æŸ¥è©¢ç‰¹å®šäº‹å¯¦ç™¼ç”Ÿæ—¥çš„å…¬å‘Š
```javascript
db.announcements.find({ "fact_occurrence_date": "2025-07-08" })
```

#### æŸ¥è©¢äº‹å¯¦ç™¼ç”Ÿæ—¥ç¯„åœ
```javascript
db.announcements.find({ 
  "fact_occurrence_date": { 
    $gte: "2025-07-01", 
    $lte: "2025-07-31" 
  } 
})
```

#### çµ±è¨ˆå„äº‹å¯¦ç™¼ç”Ÿæ—¥çš„å…¬å‘Šæ•¸é‡
```javascript
db.announcements.aggregate([
  { $match: { "fact_occurrence_date": { $exists: true, $ne: null } } },
  { $group: { 
    _id: "$fact_occurrence_date", 
    count: { $sum: 1 } 
  }},
  { $sort: { _id: 1 } }
])
```

## ğŸ“ æª”æ¡ˆä¿å­˜

### 1. **åŸå§‹ HTML æª”æ¡ˆ**
```
æª”æ¡ˆåç¨±: twse_announcements_20250818.html
å…§å®¹: å®Œæ•´çš„åŸå§‹ HTML å›æ‡‰
ç”¨é€”: ä¿ç•™åŸå§‹è³‡æ–™ä»¥ä¾›å¾ŒçºŒåˆ†ææˆ–é™¤éŒ¯
```

### 2. **JSON æª”æ¡ˆ**
```
æª”æ¡ˆåç¨±: twse_announcements_20250818.json
å…§å®¹: è§£æå¾Œçš„çµæ§‹åŒ–è³‡æ–™
åŒ…å«: äº‹å¯¦ç™¼ç”Ÿæ—¥ã€åŸå§‹ HTMLã€æ¢æ¬¾ä»£è™Ÿç­‰
```

### 3. **æ–‡å­—æª”æ¡ˆ**
```
æª”æ¡ˆåç¨±: twse_announcements_20250818.txt
å…§å®¹: äººé¡å¯è®€çš„æ ¼å¼åŒ–è¼¸å‡º
ç”¨é€”: å¿«é€Ÿç€è¦½å’Œæª¢æŸ¥è³‡æ–™
```

## ğŸ§ª æ¸¬è©¦é©—è­‰

### 1. **åŠŸèƒ½æ¸¬è©¦**

#### åŸ·è¡Œæ“·å–å‘½ä»¤
```bash
./target/release/twse-announcements.exe --date 2025-08-18 --format json --save-mongodb --save-html
```

#### é æœŸçµæœ
- âœ… æˆåŠŸæ“·å–äº‹å¯¦ç™¼ç”Ÿæ—¥
- âœ… åŸå§‹ HTML æª”æ¡ˆä¿å­˜
- âœ… JSON åŒ…å«æ–°æ¬„ä½
- âœ… MongoDB è³‡æ–™æ›´æ–°

### 2. **è³‡æ–™é©—è­‰**

#### æª¢æŸ¥äº‹å¯¦ç™¼ç”Ÿæ—¥æ ¼å¼
```
è¼¸å…¥æ ¼å¼: YYYYMMDD (å¦‚ 20250708)
è¼¸å‡ºæ ¼å¼: YYYY-MM-DD (å¦‚ 2025-07-08)
```

#### æª¢æŸ¥åŸå§‹ HTML ä¿å­˜
```
æ¯ç­†è³‡æ–™çš„ raw_html æ¬„ä½åŒ…å«å®Œæ•´çš„ <tr>...</tr> HTML å…§å®¹
```

### 3. **Web ä»‹é¢æ¸¬è©¦**

#### é–‹å•Ÿ Web æŸ¥è©¢
```
http://127.0.0.1:3000
```

#### æª¢æŸ¥é …ç›®
- âœ… äº‹å¯¦ç™¼ç”Ÿæ—¥æ¨™ç±¤é¡¯ç¤º
- âœ… é»ƒè‰²æ¨™ç±¤æ¨£å¼
- âœ… æ—¥æ›†åœ–ç¤º
- âœ… CSV åŒ¯å‡ºåŒ…å«äº‹å¯¦ç™¼ç”Ÿæ—¥

## ğŸ¯ åŠŸèƒ½å„ªå‹¢

### 1. **è³‡æ–™å®Œæ•´æ€§**
- âœ… å®Œæ•´ä¿å­˜åŸå§‹ HTML è³‡æ–™
- âœ… çµæ§‹åŒ–æ“·å–äº‹å¯¦ç™¼ç”Ÿæ—¥
- âœ… æ¨™æº–åŒ–æ—¥æœŸæ ¼å¼
- âœ… èˆ‡å…¶ä»–æ¬„ä½å®Œç¾æ•´åˆ

### 2. **ä½¿ç”¨è€…é«”é©—**
- âœ… è¦–è¦ºåŒ–äº‹å¯¦ç™¼ç”Ÿæ—¥æ¨™ç±¤
- âœ… ç›´è§€çš„æ—¥æœŸé¡¯ç¤ºæ ¼å¼
- âœ… CSV åŒ¯å‡ºåŒ…å«å®Œæ•´è³‡è¨Š
- âœ… æ”¯æ´æ—¥æœŸç¯„åœæŸ¥è©¢

### 3. **æŠ€è¡“ç©©å®šæ€§**
- âœ… è‡ªå‹•æ—¥æœŸæ ¼å¼è½‰æ›
- âœ… éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- âœ… åŸå§‹è³‡æ–™å‚™ä»½
- âœ… å‘å¾Œç›¸å®¹æ€§

### 4. **åˆ†æä¾¿åˆ©æ€§**
- âœ… æ”¯æ´äº‹å¯¦ç™¼ç”Ÿæ—¥çµ±è¨ˆ
- âœ… ä¾¿æ–¼æ™‚é–“åºåˆ—åˆ†æ
- âœ… åŸå§‹ HTML å¯ä¾›æ·±åº¦åˆ†æ
- âœ… æ¨™æº–åŒ–è³‡æ–™æ ¼å¼

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. **æ“·å–è³‡æ–™ä¸¦ä¿å­˜ HTML**
```bash
./target/release/twse-announcements.exe --date 2025-08-18 --format json --save-mongodb --save-html
```

### 2. **Web æŸ¥è©¢**
```bash
# å•Ÿå‹• Web æœå‹™å™¨
./target/release/simple_web_server.exe

# é–‹å•Ÿç€è¦½å™¨
http://127.0.0.1:3000
```

### 3. **API æŸ¥è©¢**
```bash
# æŸ¥è©¢åŒ…å«äº‹å¯¦ç™¼ç”Ÿæ—¥çš„å…¬å‘Š
curl "http://127.0.0.1:3000/api/announcements?limit=10" | jq '.[].fact_occurrence_date'
```

## ğŸ‰ å¯¦ç¾æˆæœ

### æˆåŠŸå»ºç«‹
- âœ… **äº‹å¯¦ç™¼ç”Ÿæ—¥æ“·å–**: å¾ h07 ç­‰æ¬„ä½è‡ªå‹•æ“·å–
- âœ… **æ—¥æœŸæ ¼å¼åŒ–**: YYYYMMDD -> YYYY-MM-DD
- âœ… **åŸå§‹ HTML ä¿å­˜**: å®Œæ•´ä¿å­˜æ¯ç­†è³‡æ–™çš„åŸå§‹ HTML
- âœ… **æª”æ¡ˆä¿å­˜**: HTMLã€JSONã€TXT ä¸‰ç¨®æ ¼å¼

### è³‡æ–™å®Œæ•´æ€§
- âœ… **çµæ§‹åŒ–è³‡æ–™**: äº‹å¯¦ç™¼ç”Ÿæ—¥å­˜å…¥ JSON å’Œ MongoDB
- âœ… **åŸå§‹è³‡æ–™**: å®Œæ•´çš„ HTML å…§å®¹ä¿å­˜
- âœ… **æ ¼å¼æ¨™æº–åŒ–**: çµ±ä¸€çš„æ—¥æœŸæ ¼å¼
- âœ… **å‘å¾Œç›¸å®¹**: ä¸å½±éŸ¿ç¾æœ‰åŠŸèƒ½

### ä½¿ç”¨è€…é«”é©—
- âœ… **è¦–è¦ºæ¨™ç±¤**: é»ƒè‰²äº‹å¯¦ç™¼ç”Ÿæ—¥æ¨™ç±¤
- âœ… **CSV åŒ¯å‡º**: åŒ…å«äº‹å¯¦ç™¼ç”Ÿæ—¥æ¬„ä½
- âœ… **API æ”¯æ´**: ç¨‹å¼åŒ–æŸ¥è©¢ä»‹é¢
- âœ… **æŸ¥è©¢ä¾¿åˆ©**: æ”¯æ´æ—¥æœŸç¯„åœæŸ¥è©¢

ğŸŠ **äº‹å¯¦ç™¼ç”Ÿæ—¥æ“·å–åŠŸèƒ½å·²å®Œå…¨å¯¦ç¾ï¼ç¾åœ¨æ¯å€‹é‡å¤§è¨Šæ¯éƒ½æœƒé¡¯ç¤ºå°æ‡‰çš„äº‹å¯¦ç™¼ç”Ÿæ—¥ï¼Œä¸¦ä¸”åŸå§‹ HTML è³‡æ–™å®Œæ•´ä¿å­˜ï¼Œå¤§å¤§æå‡äº†è³‡æ–™çš„å®Œæ•´æ€§å’Œåˆ†æåƒ¹å€¼ï¼**
